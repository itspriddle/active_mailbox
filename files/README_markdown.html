<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>README.markdown</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            README.markdown
        </h1>
        <ul class="files">
            <li>README.markdown</li>
            <li>Last modified: Fri Dec 10 14:13:00 -0500 2010</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <h1>ActiveMailbox</h1>

<p>ActiveMailbox provides a simple API and command line utility to work with
voicemail boxes and voicemails generated by Asterisk.</p>

<h2>Command line usage via active_mailbox</h2>

<p>ActiveMailbox includes a command line tool which administrators can use to
perform maintenance on a user's mailbox.</p>

<p>The command takes <strong>three</strong> arguments: the action (OPTION), the context
defined in voicemail.conf (CONTEXT), and the user's phone number (MAILBOX)</p>

<pre><code>Usage: active_mailbox [OPTION] MAILBOX

Mailbox Options:
        --context                    Look for [MAILBOX] in [CONTEXT]
        --delete                     Delete [MAILBOX] and all messages
        --sort                       Sort messages in [MAILBOX] (recursive)

Cleanup Options:
        --clean-ghosts               Cleanup 'ghost' messages
        --clean-stale                Cleanup messages older than 30 days
        --clean-mp3s                 Cleanup [MAILBOX]/.mp3 directory
        --purge                      Remove all messages, but leave [MAILBOX] folders intact

Greeting Options:
        --delete-temp                Delete [MAILBOX]/temp.wav
        --delete-unavail             Delete [MAILBOX]/unavail.wav
        --delete-busy                Delete [MAILBOX]/busy.wav

General Options:
    -h, --help                       Show this message
    -v, --version                    Show version
</code></pre>

<h3>Example Command line usage</h3>

<h4>Delete unavailable greeting</h4>

<pre><code>active_mailbox --delete-unavail 15183332220
</code></pre>

<h4>Delete temp greeting</h4>

<pre><code>active_mailbox --delete-temp 15183332220
</code></pre>

<h4>Purge mailbox (deletes all messages, leaves folders intact)</h4>

<pre><code>active_mailbox --purge 15183332220
</code></pre>

<h4>Delete messages older than 30 days</h4>

<pre><code>active_mailbox --clean-stale 15183332220
</code></pre>

<h4>Delete mailbox</h4>

<pre><code>active_mailbox --delete 15183332222
</code></pre>

<h4>Delete 'ghost' messages</h4>

<p>Ghost voicemails happen if a message's txt file exists, but the
corresponding wav file does not. Example:</p>

<pre><code>tree 518/15183332225/INBOX
    518/15183332225/INBOX
    |-- msg0000.txt
    |-- msg0000.wav
    `-- msg0002.txt
</code></pre>

<p>Run <code>active_mailbox --clean-ghosts</code> to clear the offending txt files.</p>

<pre><code>active_mailbox --clean-ghosts 518 15183332220
</code></pre>

<p>Observe the results:</p>

<pre><code>tree 518/15183332225/INBOX
    518/15183332225/INBOX
    |-- msg0000.txt
    `-- msg0000.wav
</code></pre>

<h4>Sorting</h4>

<p>If voicemails are manually deleted, the INBOX order can be out of sync, as
depicted below:</p>

<pre><code>tree 518/15183332225/INBOX
    518/15183332225/INBOX
    |-- msg0000.txt
    |-- msg0000.wav
    |-- msg0002.txt
    |-- msg0002.wav
    |-- msg0006.txt
    |-- msg0006.wav
    |-- msg0009.txt
    `-- msg0009.wav
</code></pre>

<p>Sort the messages so they play correctly in Asterisk using
<code>active_mailbox --sort</code>:</p>

<pre><code>active_mailbox --sort 15183332225
</code></pre>

<p>Messages are renamed in INBOX after sorting</p>

<pre><code>tree 518/15183332225/INBOX
    518/15183332225/INBOX
    |-- msg0000.txt
    |-- msg0000.wav
    |-- msg0001.txt
    |-- msg0001.wav
    |-- msg0002.txt
    |-- msg0002.wav
    |-- msg0003.txt
    `-- msg0003.wav
</code></pre>

<h2>Library Usage</h2>

<p>ActiveMailbox can also be used in ruby scripts to work with mailboxes
and voicemail messages.</p>

<h3>Working with mailboxes</h3>

<pre><code># Create a mailbox object
mailbox = ActiveMailbox::Mailbox.find('office_a', '1234')

# Destroy mailbox and all messages/greetings
mailbox.destroy!

# Determine the greeting Asterisk will playback
mailbox.current_greeting

# Destroy ``unavail.wav``
mailbox.destroy_greeting!

# Destroy ``temp.wav``
mailbox.destroy_temp!

# A Hash of the mailbox's messages
#
# Keys are the subdirectory, lowercased, as
# a symbol. Eg: INBOX = :inbox, Old = :old
#
# Values are arrays of Message objects
mailbox.folders

# Fetch array of messages in :inbox
inbox = mailbox.folders[:inbox]

# Or some sugar
inbox = mailbox.inbox

# Or :old
mailbox.folders[:old]
mailbox.old
</code></pre>

<h3>Working with messages</h3>

<pre><code># Set mailbox
mailbox = ActiveMailbox::Mailbox.find('office_a', '1234')

# Get first message in INBOX
vm = mailbox.inbox.first

# Path to Asterisk generated msg####.txt
vm.txt

# Path to Asterisk generated msg####.wav
vm.wav

# Caller ID name
vm.callerid_name

# Caller ID number
vm.callerid_number

# Message duration (in seconds)
vm.duration

# Delete this message
# Deletes wav, txt, mp3, xml files
vm.destroy!
</code></pre>

<h2>Notes</h2>

<p>If Asterisk does <strong>not</strong> keep voicemail in
<code>/var/spool/asterisk/voicemail</code> on this server, add the following
to <code>~/.bashrc</code> (or the appropriate shell config file):</p>

<pre><code>export ASTERISK_VOICEMAIL_ROOT='/my/alternate/voicemail/path'
</code></pre>

<p>Note that you can specify this as an ENV variable when running the
<code>active_mailbox</code> executable.</p>

<pre><code>ASTERISK_VOICEMAIL_ROOT='/root' active_mailbox [OPTION] MAILBOX
</code></pre>

<h2>Development</h2>

<p>ActiveMailbox is still in development, as such, don't use it yet unless you're
brave. Then again, if you're using Asterisk, you're already a cowboy so have
fun!</p>

<h2>License</h2>

<p>MIT License, see LICENSE.</p>
<script type="text/javascript">$(function() {
  $('a').each(function() { $(this).attr('target', '_blank') })
})</script>

    </div>
    

    

    
    

    
    

    

    

    

    

    

    
</div>
    </div>
  </body>
</html>